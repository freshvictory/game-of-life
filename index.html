<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Conway's Game of Life</title>
  <link rel="stylesheet" href="main.css">
  <script src="util.js"></script>
</head>

<body>
  <main>
    <canvas id="canvas" width="800" height="800"></canvas>

    <div class="sidebar">
      <h1>Conway's Game of Life</h1>

      <form id="controls">

        <div class="actions">
          <button id="run-button" type="submit">Run</button>
          <button id="stop-button" type="button">Clear</button>
        </div>

        <div class="inputs">

          <div class="slider-group">
            <output id="cell-size-slider-value"></output>
            <label for="cell-size-slider">Cell Width</label>
            <input type="range" name="cell-size" id="cell-size-slider" value="1" step="1" min="0" max="7">
          </div>

          <div class="slider-group">
            <output id="speed-slider-value"></output>
            <label for="speed-slider">Speed</label>
            <input type="range" name="speed" id="speed-slider" value="4" step="1" min="0" max="6">
          </div>

          <div class="slider-group">
            <output id="probability-slider-value"></output>
            <label for="probability-slider">Probability</label>
            <input type="range" name="probability" id="probability-slider" value="4" step="1" min="0" max="7">
          </div>

          <div class="color-group">
            <label for="cell-color-picker">Cell</label>
            <input type="color" value="#8d5fbb" id="cell-color-picker">
            <label for="background-color-picker">Background</label>
            <input type="color" id="background-color-picker">
          </div>

        </div>

      </form>

      <canvas id="preview" width="100" height="100"></canvas>

    </div>
  </main>
  <script>
    const ELEMENT_OPTIONS = {
      controls: 'controls',
      cellSize: {
        type: 'slider',
        base: 'cell-size',
        values: [1, 2, 4, 5, 8, 10, 20, 25]
      },
      speed: {
        type: 'slider',
        base: 'speed',
        values: [0.1, 0.25, 0.33, 0.5, 1, 2, 3]
      },
      probability: {
        type: 'slider',
        base: 'probability',
        values: [0.05, 0.1, 0.15, 0.2, 0.25, 0.33, 0.5, 0.7]
      },
      cellColor: {
        type: 'color',
        id: 'cell-color-picker'
      },
      backgroundColor: {
        type: 'color',
        id: 'background-color-picker'
      },
      stop: 'stop-button',
      run: 'run-button',
      canvas: 'canvas',
      previewCanvas: 'preview'
    };

    const ELEMENTS = buildElements(ELEMENT_OPTIONS);

    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      ELEMENTS.backgroundColor.picker.value = '#000000';
    } else {
      ELEMENTS.backgroundColor.picker.value = '#ffffff';
    }

    on('input', function () {
      setColor('accent', ELEMENTS.cellColor.value().hex);
    }, ELEMENTS.cellColor.picker);
  </script>
  <script type="module">
    import { run, stop, preview } from './index.js';

    on('click', function () {
      stop(ELEMENTS.canvas);
    }, ELEMENTS.stop);

    preview(ELEMENTS.canvas, ELEMENTS.previewCanvas);

    on('submit', function (event) {
      event.preventDefault();
      setColor('background', ELEMENTS.backgroundColor.value().hex, ELEMENTS.canvas);
      setColor('background', ELEMENTS.backgroundColor.value().hex, ELEMENTS.previewCanvas);
      run({
        canvas: ELEMENTS.canvas,
        previewCanvas: ELEMENTS.previewCanvas,
        cellSize: ELEMENTS.cellSize.value(),
        speed: ELEMENTS.speed.value(),
        probability: ELEMENTS.probability.value(),
        color: ELEMENTS.cellColor.value().rgb
      });
    }, ELEMENTS.controls);
  </script>
</body>

</html>
