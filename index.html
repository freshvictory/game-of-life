<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Conway's Game of Life</title>
  <link rel="stylesheet" href="main.css">
</head>

<body>
  <main>
    <canvas id="canvas" width="800" height="800"></canvas>
    <div class="sidebar">
      <h1>Conway's Game of Life</h1>
      <form id="controls">
        <div class="actions">
          <button id="run-button" type="submit">Run</button>
          <button id="stop-button" type="button">Clear</button>
        </div>
        <div class="inputs">
          <div class="slider-group">
            <output id="cell-size-slider-value"></output>
            <label for="cell-size-slider">Cell Width</label>
            <input type="range" name="cell-size" id="cell-size-slider" value="1" step="1" min="0" max="7">
          </div>
          <div class="slider-group">
            <output id="speed-slider-value"></output>
            <label for="speed-slider">Speed</label>
            <input type="range" name="speed" id="speed-slider" value="4" step="1" min="0" max="6">
          </div>
          <div class="slider-group">
            <output id="probability-slider-value"></output>
            <label for="probability-slider">Probability</label>
            <input type="range" name="probability" id="probability-slider" value="4" step="1" min="0" max="7">
          </div>
          <div class="color-group">
            <label for="cell-color-picker">Cell</label>
            <input type="color" value="#8d5fbb" id="cell-color-picker">
            <label for="background-color-picker">Background</label>
            <input type="color" value="#FFFFFF" id="background-color-picker">
          </div>
        </div>
      </form>
      <canvas id="preview" width="100" height="100"></canvas>
    </div>
  </main>
  <script type="module">
    import { run, stop, preview } from './index.js';

    const speeds = [0.1, 0.25, 0.33, 0.5, 1, 2, 3];
    const cellSizes = [1, 2, 4, 5, 8, 10, 20, 25];
    const probabilities = [0.05, 0.1, 0.2, 0.3, 0.5, 0.7, 0.8, 0.9];

    const controlForm = document.getElementById('controls');
    const cellSizeSlider = document.getElementById('cell-size-slider');
    const cellSizeValue = document.getElementById('cell-size-slider-value');
    const speedSlider = document.getElementById('speed-slider');
    const speedValue = document.getElementById('speed-slider-value');
    const probabilitySlider = document.getElementById('probability-slider');
    const probabilityValue = document.getElementById('probability-slider-value');
    const cellColorPicker = document.getElementById('cell-color-picker');
    const backgroundColorPicker = document.getElementById('background-color-picker');
    const stopButton = document.getElementById('stop-button');
    const canvas = document.getElementById('canvas');
    const previewCanvas = document.getElementById('preview');
    stopButton.addEventListener('click', function () {
      stop(canvas);
    });
    preview(canvas, previewCanvas);
    controlForm.addEventListener('submit', function (event) {
      event.preventDefault();
      const cellSize = parseInt(cellSizeSlider.value, 10);
      const speed = parseInt(speedSlider.value, 10);
      const probability = parseInt(probabilitySlider.value, 10);
      const rgb = [
        parseInt(cellColorPicker.value.substring(1, 3), 16),
        parseInt(cellColorPicker.value.substring(3, 5), 16),
        parseInt(cellColorPicker.value.substring(5, 7), 16)
      ];
      canvas.style.setProperty('--c-background', backgroundColorPicker.value);
      previewCanvas.style.setProperty('--c-background', backgroundColorPicker.value);
      run({
        canvas,
        previewCanvas,
        cellSize: cellSizes[cellSize],
        speed: speeds[speed],
        probability: probabilities[probability],
        color: rgb
      });
    });
    function updateCellSizeValue() {
      cellSizeValue.innerHTML = cellSizes[cellSizeSlider.value];
    }
    function updateSpeedValue() {
      speedValue.innerHTML = speeds[speedSlider.value];
    }
    function updateProbabilityValue() {
      probabilityValue.innerHTML = probabilities[probabilitySlider.value];
    }
    function updateCellColor() {
      document.body.style.setProperty('--c-accent', cellColorPicker.value);
    }
    cellSizeSlider.addEventListener('input', updateCellSizeValue);
    speedSlider.addEventListener('input', updateSpeedValue);
    probabilitySlider.addEventListener('input', updateProbabilityValue);
    cellColorPicker.addEventListener('input', updateCellColor);
    updateCellSizeValue();
    updateSpeedValue();
    updateProbabilityValue();
    if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
      backgroundColorPicker.value = '#000000';
    }
  </script>
</body>

</html>
